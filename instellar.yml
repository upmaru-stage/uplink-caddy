dependencies:
  build:
    - go
  runtime:
    - ca-certificates
    - uplink-caddy-openrc
    
stack: alpine/3.14

build:
  destination: 'build'
  command: |
    go install github.com/caddyserver/xcaddy/cmd/xcaddy@latest

    mkdir build

    ~/go/bin/xcaddy build --output ./build/caddy --with github.com/ss098/certmagic-s3

run: 
  name: uplink-caddy
  command:
    call: '--'
    variations:
      checkconfig: validate

hook:
  post-install: |
    rc-update add uplink-caddy

  pre-upgrade: |
    rc-service uplink-caddy stop

  post-upgrade: |
    rc-service uplink-caddy start

  post-deinstall: |
    rc-service uplink-caddy stop
    rc-update del uplink-caddy


